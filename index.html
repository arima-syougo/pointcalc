<!DOCTYPE html>
<html lang="ja">    
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="reset.css">
    <title>得点計算</title>      
    <meta name="description" content="筆記用具杯、3チームパート専用" />
</head>
<body class="body">

    <!-- チーム名入力画面 -->
    <div class="form_wrapper wrapper" id="modal">
        <form class="form form_re" action="">
            <p class="team_name">このパートのチーム名を入力してください</p>
            <p class="team_text">1チーム目の名前を入力してください</p>
            <input type="text" class="form_input input" id="num1" placeholder="チーム名" value="">
            <p class="team_text">2チーム目の名前を入力してください</p>
            <input type="text" class="form_input input" id="num2" placeholder="チーム名" value="">
            <p class="team_text">3チーム目の名前を入力してください</p>
            <input type="text" class="form_input input" id="num3" placeholder="チーム名" value="">
            <input type="reset" class="form_button button" id="form_enter" value="確定">
        </form>
    </div>



    
    <!-- 得点計算 -->
    <form class="calc_form" id="calc">
        <div class="calc_wrapper">
            <div class="battle form">
                <h2 class="battle_ttl">第一試合<span class="red"> 半角数字で入力</span></h2>
                <p class="battle_txt fi_team_point">1チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point1" placeholder="半角数字で入力" value="">
                <p class="battle_txt sc_team_point">2チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point2" placeholder="半角数字で入力" value="">
                <p class="battle_txt fi_team_set">1チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set1" placeholder="半角数字で入力" value="">
                <p class="battle_txt sc_team_set">2チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set2" placeholder="半角数字で入力" value="">
            </div>
            
            <div class="battle form">
                <h2 class="battle_ttl">第二試合<span class="red"> 半角数字で入力</span></h2>
                <p class="battle_txt fi_team_point">1チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point3" placeholder="半角数字で入力" value="">
                <p class="battle_txt th_team_point">3チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point4" placeholder="半角数字で入力" value="">
                <p class="battle_txt fi_team_set">1チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set3" placeholder="半角数字で入力" value="">
                <p class="battle_txt th_team_set">3チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set4" placeholder="半角数字で入力" value="">
            </div>   
    
            <div class="battle form">
                <h2 class="battle_ttl">第三試合<span class="red"> 半角数字で入力</span></h2>
                <p class="battle_txt sc_team_point">2チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point5" placeholder="半角数字で入力" value="">
                <p class="battle_txt th_team_point">3チーム目の総得点数を入力してください</p>
                <input type="number" class="battle_input input" id="point6" placeholder="半角数字で入力" value="">
                <p class="battle_txt sc_team_set">2チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set5" placeholder="半角数字で入力" value="">
                <p class="battle_txt th_team_set">3チーム目の取得セット数を入力してください</p>
                <input type="number" class="battle_input input" id="set6" placeholder="半角数字で入力" value="">
            </div>
        </div>
        <input type="reset" class="calc_btn button" id="calc_enter" value="確定">
    </form>

    



    <!-- 結果表生成 -->
    <!-- 表に使う値　順位、チーム名、勝利、総得点、総失点、得点率、得セット、失うセット、セット率 -->
    <div class="result">
        <table class="result_table">
            <thead>
                <tr class="result_line">
                    <th class="result_ttl">順位</th>
                    <th class="result_ttl">チーム名</th>
                    <th class="result_ttl">勝利数</th>
                    <th class="result_ttl">得セット</th>
                    <th class="result_ttl">失セット</th>
                    <th class="result_ttl">セット率</th>
                    <th class="result_ttl">総得点</th>
                    <th class="result_ttl">総失点</th>
                    <th class="result_ttl">得失点</th>
                </tr>
            </thead>
            <tbody class="result_table" id="create">

            </tbody>
        </table>

        <input type="button" class="result_continue button hide" id="result_btn" value="続けて入力">
    </div>


    

    <script>
        // 変数宣言
        //チーム名を入れる型を用意
        let team1 = "";
        let team2 = "";
        let team3 = "";
        //勝利数
        let win1 = 0;
        let win2 = 0;
        let win3 = 0;
        //チームごとの得点とセット数
        let team1Point = 0;
        let team2Point = 0;
        let team3Point = 0;
        let team1Set = 0;
        let team2Set = 0;
        let team3Set = 0;
        //チームごとの失セット、失ポイント
        let team1LossPoint = 0;
        let team2LossPoint = 0;
        let team3LossPoint = 0;
        let team1LossSet = 0;
        let team2LossSet = 0;
        let team3LossSet = 0;
        //modalの要素
        //得点
        let point1 = 0;
        let point2 = 0;
        let point3 = 0;
        let point4 = 0;
        let point5 = 0;
        let point6 = 0;
        //得点率
        let pointpersent1 = 0;
        let pointpersent2 = 0;
        let pointpersent3 = 0;
        //セット
        let set1 = 0;
        let set2 = 0;
        let set3 = 0;
        let set4 = 0;
        let set5 = 0;
        let set6 = 0;
        //セット率
        let setPersent1 = 0;
        let setPersent2 = 0;
        let setPersent3 = 0;

        //modal取得
        const modal = document.getElementById("modal");
        const calc = document.getElementById("calc");

        //文章の要素を取得　クラスが複数の場合は、Elemen[s]になる 文章を変えるための準備
        let Point_Sentence1 = document.getElementsByClassName("fi_team_point");
        let Point_Sentence2 = document.getElementsByClassName("sc_team_point");
        let Point_Sentence3 = document.getElementsByClassName("th_team_point");
        let Set_Sentence1 = document.getElementsByClassName("fi_team_set");
        let Set_Sentence2 = document.getElementsByClassName("sc_team_set");
        let Set_Sentence3 = document.getElementsByClassName("th_team_set");

        //ボタンの要素取得
        const triger1 = document.getElementById("form_enter");
        const triger2 = document.getElementById("calc_enter");
        const triger3 = document.getElementById("result_btn");

        //最終結果表を作るための配列宣言
        let array = [];

        //表の要素
        const table = document.getElementById("create");
        let children = table.children;

        // イベント
        //押すと、入力されたチーム名を取得する。
        triger1.addEventListener("click",ReadyTeamName);
        triger2.addEventListener("click",TeamResult);
        triger3.addEventListener("click",TeamRename);



        // 関数
        //チーム名を取得、計算表に反映
        function ReadyTeamName() {
            //チーム名を代入
            team1 = document.getElementById("num1").value;
            team2 = document.getElementById("num2").value;
            team3 = document.getElementById("num3").value;
            // 試合結果入力欄の名前を変更
            for(let i = 0;i < 2;i++) {
                Point_Sentence1[i].innerHTML = team1 + "の総得点数を入力してください";
                Point_Sentence2[i].innerHTML = team2 + "の総得点数を入力してください";
                Point_Sentence3[i].innerHTML = team3 + "の総得点数を入力してください";
                Set_Sentence1[i].innerHTML = team1 + "の取得セット数を入力してください";
                Set_Sentence2[i].innerHTML = team2 + "の取得セット数を入力してください";
                Set_Sentence3[i].innerHTML = team3 + "の取得セット数を入力してください";
            }
            //modalを隠す
            modal.classList.add("hide");
        }


        //チーム表を生成
        function TeamResult() {
            TeamCalc();
                    //順位をつける
            array.forEach(function(Num,index){
                Num.rank = index + 1;
            })
                    //配列の回数だけ試行を行う
            array.forEach(content => {
                        //新しい表のtr要素を作る
                const row = document.createElement("tr");
                //配列の中のオブジェクトについてそのオブジェクトの数だけ試行
                Object.values(content).forEach(resultNum => {
                    //表の各項目データ
                    const cell = document.createElement("td");
                    cell.textContent = resultNum;
                    row.appendChild(cell);
                });
                table.appendChild(row);
            });

            //点数入力欄を隠す
            calc.classList.add("hide");
            //続けて入力欄を出す
            triger3.classList.remove("hide");
            //ページトップへ
            window.scrollTo({
                top:0,
                behavior:"smooth"
            });
        }


        //合計得点、合計セットの計算 1チーム目 1,3 2チーム目2,5 3チーム目4,6
        //合計失点、失ったセットの計算 1チーム目2,4 2チーム目1,6 3チーム目3,5
        //1試合目 1,2  2試合目 3,4 3試合目5,6
        // 数字として取得する必要がある
        function TeamCalc() {
            //それぞれの入力された数値を取得
            point1 = +document.getElementById("point1").value;
            point2 = +document.getElementById("point2").value;
            point3 = +document.getElementById("point3").value;
            point4 = +document.getElementById("point4").value;
            point5 = +document.getElementById("point5").value;
            point6 = +document.getElementById("point6").value;
            set1 = +document.getElementById("set1").value;
            set2 = +document.getElementById("set2").value;
            set3 = +document.getElementById("set3").value;
            set4 = +document.getElementById("set4").value;
            set5 = +document.getElementById("set5").value;
            set6 = +document.getElementById("set6").value;
    
            //勝利数
            //1試合目
            if(set1 > set2) {
                win1 = win1 + 1;
            } else if(set1 < set2) {
                win2 = win2 + 1;
            }  

            if(set3 > set4) {
                win1 = win1 + 1;
            } else if (set3 < set4) {
                win3 = win3 + 1;
            }

            // 3試合目
            if(set5 > set6) {
                win2 = win2 + 1;
            } else if(set5 < set6) {
                win3 = win3 + 1;
            }
    
            // 合計得点
            team1Point = point1 + point3;
            team2Point = point2 + point5;
            team3Point = point4 + point6;
            // 合計セットポイント
            team1Set = set1 + set3;
            team2Set = set2 + set5;
            team3Set = set4 + set6;
            // 合計失点
            team1LossPoint = point2 + point4;
            team2LossPoint = point1 + point6;
            team3LossPoint = point3 + point5;
            // 失セット
            team1LossSet = set2 + set4;
            team2LossSet = set1 + set6;
            team3LossSet = set3 + set5;
            //セット率計算 
            setPersent1 = team1Set / team1LossSet;
            setPersent2 = team2Set / team2LossSet;
            setPersent3 = team3Set / team3LossSet;
            //小数点以下3桁に丸める
            setPersent1 = Math.floor(setPersent1 * 1000) / 1000;
            setPersent2 = Math.floor(setPersent2 * 1000) / 1000;
            setPersent3 = Math.floor(setPersent3 * 1000) / 1000;
            //得点率計算
            pointpersent1 = team1Point - team1LossPoint;
            pointpersent2 = team2Point - team2LossPoint;
            pointpersent3 = team3Point - team3LossPoint;


            //配列に入れる
            array.push({
                rank:1,
                name:team1,
                win:win1,
                set:team1Set,
                lossSet:team1LossSet,
                setPersent:setPersent1,
                point:team1Point,
                lossPoint:team1LossPoint,
                pointPersent:pointpersent1});
            array.push({
                rank:1,
                name:team2,
                win:win2,
                set:team2Set,
                lossSet:team2LossSet,
                setPersent:setPersent2,
                point:team2Point,
                lossPoint:team2LossPoint,
                pointPersent:pointpersent2});
            array.push({
                rank:1,
                name:team3,
                win:win3,
                set:team3Set,
                lossSet:team3LossSet,
                setPersent:setPersent3,
                point:team3Point,
                lossPoint:team3LossPoint,
                pointPersent:pointpersent3});
            //順位を並び替え
            array.sort(function(a,b){
                if(a.win !== b.win) {
                    return b.win - a.win;
                }
            if(a.setPersent !== b.setPersent){
                    return b.setPersent - a.setPersent;
                }
                if(a.pointPersent !== b.pointPersent){
                    return b.pointPersent - a.pointPersent;
                }
            });
        }


        //得点などを全て初期化、再びモーダルへ移動　もしくは、新たな配列を生成、そこに入れる。
        function TeamRename() {
            modal.classList.remove("hide");
            calc.classList.remove("hide");
            triger3.classList.add("hide");
            //表示されている表を消す ループ処理要らず。コードの子要素を無くしている。
            table.innerHTML = "";
            //勝ち数をリセット
            win1 = 0;
            win2 = 0;
            win3 = 0;
        }

        //全ての処理を終えて、表示が完了したら初期化する。

        //HTMLで受け取った要素は、文字列として受け取られる。
        //それを数値にしたい場合は、Number()や、プラス演算子などを利用する。
        //for(let key in 〇〇)  keyがプロパティ名　[]の中に入れるとオブジェクトの中のインデックス番号的な役割になる
        //object.values(〇〇) オブジェクト〇〇の中の全ての値を配列として返す
        //appendChild子要素に追加
        //foreachでインデックス番号をつけたい場合は、引数にindexを
        //TODOオブジェクトにまとめる
    </script>
</body>
</html>

<!-- TODO fontの変更 統一できるクラスは、統一する。 無駄にcssで同じクラス名を２回使わない 不要な記述がないのか検証ツールで確認 -->
